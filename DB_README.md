# LPC Character Generator Database

This directory contains SQLite database schema and population scripts for the Universal LPC Spritesheet Character Generator. The database efficiently references all available spritesheets in the repository, making it easier to query and use the assets programmatically.

## Files

- `lpc_character_generator.sql` - SQLite schema for the database
- `populate_database.lua` - Lua script to populate the database from the sheet_definitions directory
- `lpc_character_generator.db` - The resulting SQLite database (generated by the script)

## Database Schema

The database is designed with the following key entities:

- **Categories**: Main component categories (body, arms, torso, etc.)
- **Component Types**: Types within categories (e.g., clothes, jacket, chainmail)
- **Components**: Individual items (e.g., specific clothes, weapons)
- **Variants**: Color/material variations (e.g., red, blue, steel)
- **Animations**: Available animation types (walk, run, attack, etc.)
- **Body Types**: Different character body types (male, female, etc.)
- **Layers**: Z-ordered layers for each component
- **Asset Files**: References to the actual PNG files

The database also includes comprehensive credit information:
- **Authors**: Contributors to the assets
- **Licenses**: License types used
- **Credits**: Specific credits for each component

## Requirements

To run the database population script, you'll need:

1. Lua 5.1+ or LuaJIT
2. The following Lua modules:
   - `lsqlite3` - SQLite bindings for Lua
   - `dkjson` - JSON parser for Lua
   - `lfs` (LuaFileSystem) - for directory traversal

### Installing dependencies

```bash
# Install Lua (if not already installed)
# On macOS:
brew install lua luajit

# On Ubuntu/Debian:
sudo apt-get install lua5.1 luajit

# Install LuaRocks (package manager)
# On macOS:
brew install luarocks

# On Ubuntu/Debian:
sudo apt-get install luarocks

# Install required modules
luarocks install lsqlite3
luarocks install dkjson
luarocks install luafilesystem
```

## Generating the Database

1. Clone the repository (if you haven't already)
2. Make sure the schema file (`lpc_character_generator.sql`) is in the current directory
3. Run the population script:

```bash
lua populate_database.lua
```

This process may take some time as it needs to scan all sheet definition files and all spritesheet assets. The script will output progress information.

**Note**: Due to the large amount of assets (1GB+), the database will efficiently reference the files without actually storing the image data. File paths are stored instead, making the database itself much smaller and more manageable.

## Using the Database

The resulting SQLite database can be queried using any SQLite client or programming language with SQLite support.

### Example Queries

#### Get all available components by category

```sql
SELECT * FROM view_available_components
WHERE category_name = 'weapon'
ORDER BY component_display_name;
```

#### Get all variants for a specific component

```sql
SELECT * FROM view_component_variants
WHERE component_name = 'torso_clothes_blouse';
```

#### Get all animations available for a component

```sql
SELECT * FROM view_component_animations
WHERE component_name = 'weapon_sword_arming';
```

#### Get file paths for a specific component, variant, and animation

```sql
SELECT * FROM view_asset_files
WHERE component_name = 'torso_clothes_blouse'
AND variant_name = 'red'
AND animation_name = 'walk'
AND body_type_name = 'female';
```

#### Get credits for a component

```sql
SELECT * FROM view_component_credits
WHERE component_name = 'wings_bat';
```

## Schema Migration and Updates

If you need to update the schema:

1. Modify the `lpc_character_generator.sql` file
2. Delete the existing database file
3. Run the population script again

## Performance Considerations

- The database uses indexes on commonly queried fields for better performance
- Foreign key constraints ensure data integrity
- Views are provided for common query patterns
- The population script uses transactions for faster inserts

## License

This database schema and population script are provided under the same license as the Universal LPC Spritesheet Character Generator. See the main LICENSE file for details.

The database itself contains only references to assets and their metadata, not the assets themselves. All credit information is preserved and retrievable through the database. 